{% extends 'base.html' %}
{% load currency %}

{% block title %}Dashboard{% endblock %}

{% block content %}

<!-- FILTER -->
<form method="GET" class="flex gap-3 mb-5">
    <select name="month" class="p-2 bg-gray-800 rounded">
        {% for m, label in months %}
        <option value="{{ m }}" {% if m == selected_month %}selected{% endif %}>
            {{ label }}
        </option>
        {% endfor %}
    </select>

    <select name="year" class="p-2 bg-gray-800 rounded">
        {% for y in years %}
        <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>
            {{ y }}
        </option>
        {% endfor %}
    </select>

    <button class="px-4 bg-indigo-600 rounded text-white">Apply</button>
</form>


<!-- SUMMARY -->
<div class="grid grid-cols-3 gap-3 mb-6">
    <div class="p-4 bg-gray-800 rounded">
        <div class="text-sm text-gray-400">Income</div>
        <div class="text-green-400 text-xl font-bold">{{ income_total|rupiah }}</div>
    </div>
    <div class="p-4 bg-gray-800 rounded">
        <div class="text-sm text-gray-400">Expense</div>
        <div class="text-red-400 text-xl font-bold">{{ expense_total|rupiah }}</div>
    </div>
    <div class="p-4 bg-gray-800 rounded">
        <div class="text-sm text-gray-400">Balance</div>
        <div class="text-blue-400 text-xl font-bold">{{ balance|rupiah }}</div>
    </div>
</div>


<!-- CHART -->
{% if donut_values %}
<div class="h-64">
    <canvas id="expenseDonut"></canvas>
</div>
{% else %}
<div class="text-gray-500">No expense data this month.</div>
{% endif %}

<!-- RECENT -->
<h2 class="font-semibold mb-2 mt-6">Recent</h2>
<div class="space-y-2">
    {% for t in tx %}
    <div class="p-3 border border-gray-700 rounded flex justify-between">
        <div>
            <div class="font-medium">{{ t.category.name }}</div>
            <div class="text-xs text-gray-400">{{ t.date }}</div>
        </div>
        <div class="font-semibold {% if t.type == 'income' %}text-green-400{% else %}text-red-400{% endif %}">
            {% if t.type == 'income' %}+{% else %}-{% endif %}{{ t.amount }}
        </div>
    </div>
    {% empty %}
    <div class="text-gray-500">No transactions this month.</div>
    {% endfor %}
</div>

{% endblock %}


{% block extra_script %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
new Chart(document.getElementById('expenseDonut'), {
    type: 'doughnut',
    data: {
        labels: {{ donut_labels|safe }},
        datasets: [{
            data: {{ donut_values|safe }},
            backgroundColor: [
                '#10b981', '#e11d48', '#3b82f6', '#f59e0b', '#6366f1', '#84cc16', '#ef4444'
            ],
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        legend: {
            position: 'bottom'
        }
    }
});
</script>

{% endblock %}