{% extends 'base.html' %}
{% load currency %}
{% block title %}Transactions{% endblock %}

{% block content %}
<div class="flex justify-between items-center mb-4">
 <h1 class="text-xl font-semibold">Transactions</h1>
 <button 
  onclick="document.getElementById('addModal').showModal()"
  class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-500">
  Add Transaction
 </button>
</div>

<div class="space-y-2">
 {% for t in tx %}
 <div class="p-3 border border-gray-700 rounded flex justify-between">
  <div>
   <div class="font-medium">{{ t.category.name }}</div>
   <div class="text-xs text-gray-400">{{ t.date }}</div>
  </div>
  <div class="font-semibold {% if t.type == 'income' %}text-green-400{% else %}text-red-400{% endif %}">
   {% if t.type == 'income' %}+{% else %}-{% endif %}{{ t.amount|rupiah }}
  </div>
  <div class="flex gap-2">
    <a href="{% url 'transaction_edit' t.id %}" class="text-blue-400">Edit</a>
    <a href="{% url 'transaction_delete' t.id %}" class="text-red-400">Delete</a>
  </div>
 </div>
 {% empty %}
 <div class="text-gray-400">No transactions yet</div>
 {% endfor %}
</div>

<dialog id="addModal" class="rounded-md p-5 bg-gray-800 text-gray-100">
 <form method="POST" action="{% url 'transaction_add' %}" class="space-y-3">
  {% csrf_token %}

 <select name="type" class="w-full p-2 bg-gray-900 rounded border border-gray-700">
  <option value="income">Income</option>
  <option value="expense">Expense</option>
 </select>

 <select name="wallet" class="w-full p-2 bg-gray-900 rounded border border-gray-700">
   {% for w in wallets %}
   <option value="{{ w.id }}">{{ w.name }}</option>
   {% endfor %}
 </select>

  <select name="category" class="w-full p-2 bg-gray-900 rounded border border-gray-700">
   {% for c in categories %}
   <option value="{{ c.id }}">{{ c.name }} ({{ c.type }})</option>
   {% endfor %}
  </select>

 <input type="number" name="amount" placeholder="Amount" class="w-full p-2 bg-gray-900 rounded border border-gray-700"/>
 <input type="date" name="date" class="w-full p-2 bg-gray-900 rounded border border-gray-700"/>
 <textarea name="note" placeholder="Note (optional)" class="w-full p-2 bg-gray-900 rounded border border-gray-700"></textarea>

 <div class="flex gap-2 justify-end">
  <button type="button" onclick="addModal.close()" class="px-3 py-2 border border-gray-600 rounded">Cancel</button>
  <button type="submit" class="px-3 py-2 bg-indigo-600 rounded">Save</button>
 </div>
 </form>
</dialog>
{% endblock %}